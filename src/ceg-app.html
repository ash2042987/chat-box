<!-- IMPORTS -->
<!-- POLYMER -->
<link rel="import" href="../bower_components/polymer/polymer-element.html">
<!-- POLYMERFIRE -->
<link rel="import" href="../bower_components/polymerfire/firebase-auth.html">
<!-- PAPER ELEMENTS -->
<link rel="import" href="../bower_components/paper-spinner/paper-spinner.html">
<!-- CUSTOM ELEMENTS -->
  <!-- AUTH -->
  <link rel="import" href="ceg-auth/ceg-auth.html">
  <!-- VIEWS -->
  <link rel="import" href="ceg-views/ceg-chat.html">
  <link rel="import" href="ceg-views/ceg-login.html">
  <!-- STYLES -->
  <link rel="import" href="shared-styles.html">

<dom-module id="ceg-app">
  <template>
    <style>
      .overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: #3385ff;
      }
        .overlay paper-spinner {
          background: #fff;
          padding: 25px;
          border-radius: 50%;
        }
    </style>

    <!-- FIREBASE -->
    <ceg-auth></ceg-auth>

    <firebase-auth
        id="auth"
        user="{{user}}"
        provider="google"
        signed-in="{{signedIn}}">
    </firebase-auth>

    <template is="dom-if" if="{{!user}}">
      <ceg-login></ceg-login>
    </template>

    <template is="dom-if" if="{{user}}">
      <ceg-chat
        user-name="[[user.displayName]]"
        user-image="[[user.photoURL]]"
      ></ceg-chat>
    </template>

    <!-- -
    <div class="overlay">
      <paper-spinner active></paper-spinner>
    </div>
  -->

  </template>

  <script>
    class CegmagApp extends Polymer.Element {

      constructor() {
        super();
        //EVENT LISTENERS
        this.onSignIn = this.onSignIn.bind(this);
        window.addEventListener('sign-in', this.onSignIn);

        this.onSignOut = this.onSignOut.bind(this);
        window.addEventListener('sign-out', this.onSignOut);
    }

      static get is() { return 'ceg-app'; }

      static get properties() {

        return {
          signedIn: Boolean,
          user: Object
        }

      }

      onSignIn(){
        this.$.auth.signInWithPopup()
        .then( (response) => {
          console.log("Logged In Successfully!");
        })
        .catch( (error) => {
          console.log("Error");
          console.log(error)
        });
      }
      onSignOut(){
        this.$.auth.signOut()
        .then( (response) => {
          console.log("Logged Out Successfully!");
        })
        .catch( (error) => {
          console.log("Error");
          console.log(error)
        });
      }


    }

    window.customElements.define(CegmagApp.is, CegmagApp);
  </script>
</dom-module>
